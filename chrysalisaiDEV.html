<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Economic Indicator Stock Market Predictor</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <style>
    body{
      margin: 0;
      background-color: black;
    }
  </style>
</head>
<body>
  <script>
    /***********************
     * 1. Data Preparation *
     ***********************/
    const indicators = [
      "US GDP Growth Rate",
      "US Unemployment Rate",
      "US Inflation Rate",
      "US Interest Rate",
      "US Balance of Trade",
      "US Comsumer Price Index",
      "US Composite PMI",
      "US Comsumer Confidence",
      "US Volatility",
      "IN GDP Growth Rate",
      "IN Unemployment Rate",
      "IN Inflation Rate",
      "IN Interest Rate",
      "IN Balance of Trade",
      "IN Comsumer Price Index",
      "IN Composite PMI",
      "IN Comsumer Confidence",
      "IN Volatility",
      "IN Fiscal Deficit",
      "IN Foreign Direct Investments",
      "IN USD/INR"
    ];
    
    const inputSize = indicators.length;

    // Sample training data
    const trainingData = [
      { input: [2.70,4.10,2.30,4.50,-50.0,302.0,55.0,104.1,18.5,6.5,5.0,4.0,6.00,-15.0,125.8,57.7,120.0,20.0,3.5,50,75.0], label: [1, 0] },
      { input: [2.30,4.10,3.20,4.50,-50.0,305.2,52.5,104.1,18.3,6.5,5.2,4.1,6.25,-15.0,125.8,57.7,120.3,22.1,3.5,50,75.2], label: [1, 0] },
      { input: [2.30,4.10,2.90,5.25,-78.2,290.0,52.5,108.5,18.2,6.5,7.2,5.2,6.50,-15.8,150.0,54.0,95.0,14.5,3.5,45,75.5], label: [1, 0] },
      { input: [2.30,4.10,3.20,5.00,-50.0,300.0,50.0,104.1,20.0,6.5,7.0,4.5,6.00,-10.0,150.0,57.7,100.0,15.0,4.5,50.0,50.0,75.0], label: [1, 0] },
      { input: [2.30,4.10,2.90,5.25,-78.2,290.0,52.5,108.5,18.2,6.5,7.2,5.2,6.50,-15.8,150.0 ,54.0,95.0,14.5,3.5,45,75.5], label: [1, 0] },
    ];

    const trainXs = tf.tensor2d(trainingData.map(item => item.input));
    const trainYs = tf.tensor2d(trainingData.map(item => item.label));

    /**************************************
     * 2. Model Definition & Pre-Training *
     **************************************/
    function createModel() {
      const model = tf.sequential();
      model.add(tf.layers.dense({ units: 16, activation: 'relu', inputShape: [inputSize] }));
      model.add(tf.layers.dropout({ rate: 0.2 }));
      model.add(tf.layers.dense({ units: 8, activation: 'relu' }));
      model.add(tf.layers.dropout({ rate: 0.2 }));
      model.add(tf.layers.dense({ units: 2, activation: 'softmax' }));
      model.compile({ optimizer: 'adam', loss: 'categoricalCrossentropy', metrics: ['accuracy'] });
      return model;
    }

    let model;

    async function loadOrTrainModel() {
      try {
        model = await tf.loadLayersModel('./models/economic-model.json');
        console.log("Loaded existing model from local path.");
      } catch (error) {
        console.log("No saved model found. Training a new model...");
        model = createModel();
        await model.fit(trainXs, trainYs, {
          epochs: 100,
          batchSize: 2,
          shuffle: true,
          callbacks: {
            onEpochEnd: (epoch, logs) => {
              console.log(`Epoch ${epoch}: loss = ${logs.loss.toFixed(4)}, accuracy = ${logs.acc.toFixed(4)}`);
            }
          }
        });
        console.log("Training complete.");
      }

      // Run analysis immediately after model is ready
      analyzeIndicators(inputString);
    }

    /****************************************
     * 3. Economic Data Analysis Function   *
     ****************************************/
    async function analyzeIndicators(inputString) {
      if (!model) {
        console.log("Waiting for model to load...");
        return;
      }

      let inputArray = inputString.split(",").map(Number);
      if (inputArray.length !== inputSize) {
        console.log(`Error: Please provide exactly ${inputSize} values.`);
        return;
      }

      const inputTensor = tf.tensor2d([inputArray]);
      const prediction = model.predict(inputTensor);
      const predArray = prediction.dataSync();
      inputTensor.dispose();
      prediction.dispose();

      const sentiment = predArray[1] > predArray[0] ? "Negative for the Indian stock market" : "Positive for the Indian stock market";
      console.log(`Prediction: ${sentiment}`);
    }

    const inputString = "2.3,4.1,2.9,5.25,-78.2,2.9,52.5,108.5,18.2,6.5,7.2,5.2,6.5,-15.8,5.2,54.0,95.0,14.5,3.5,45,75.5";
    loadOrTrainModel();

  </script>
</body>
</html>
